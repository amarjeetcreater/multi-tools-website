<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor - Multi-Tools</title>
    <meta name="description" content="Compress images to reduce file size without losing quality. Free online image compressor.">
    <meta name="keywords" content="image compressor, compress image, reduce file size">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
    crossorigin="anonymous"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="container mt-5">
        <!-- Top Ad -->
        <div class="ad-space mb-4">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-7389985631571522"
                data-ad-slot="3374471779"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="tool-container">
                    <div class="text-center mb-4">
                        <h1><i class="fas fa-compress-alt"></i> Image Compressor</h1>
                        <p class="lead">Compress images to reduce file size without losing quality</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-upload"></i> Upload Image</h5>
                                </div>
                                <div class="card-body">
                                    <div class="file-upload-area" id="uploadArea">
                                        <div class="upload-content">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                            <h5>Drag & Drop Image Here</h5>
                                            <p>or click to browse</p>
                                            <input type="file" id="imageInput" accept="image/*" class="file-input">
                                            <button class="btn btn-primary" onclick="document.getElementById('imageInput').click()">
                                                <i class="fas fa-folder-open"></i> Choose File
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="imagePreview" class="mt-3" style="display: none;">
                                        <h6>Original Image:</h6>
                                        <img id="previewImg" class="img-fluid rounded" alt="Preview">
                                        <div class="mt-2">
                                            <small class="text-muted">Size: <span id="originalSize"></span></small><br>
                                            <small class="text-muted">File size: <span id="originalFileSize"></span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-cogs"></i> Compression Settings</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="qualitySlider" class="form-label">Quality: <span id="qualityValue">80%</span></label>
                                        <input type="range" class="form-range" id="qualitySlider" min="1" max="100" value="80">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxWidth" class="form-label">Max Width (px):</label>
                                        <input type="number" class="form-control" id="maxWidth" value="1920" min="100" max="4000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxHeight" class="form-label">Max Height (px):</label>
                                        <input type="number" class="form-control" id="maxHeight" value="1080" min="100" max="4000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="maintainAspectRatio" checked>
                                            <label class="form-check-label" for="maintainAspectRatio">
                                                Maintain aspect ratio
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="formatSelect" class="form-label">Output Format:</label>
                                        <select class="form-select" id="formatSelect">
                                            <option value="jpeg">JPEG</option>
                                            <option value="png">PNG</option>
                                            <option value="webp">WebP</option>
                                        </select>
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="compressBtn" disabled>
                                        <i class="fas fa-compress-alt"></i> Compress Image
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-download"></i> Compressed Image</h5>
                                </div>
                                <div class="card-body">
                                    <div id="resultContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Compressed Image:</h6>
                                                <img id="resultImg" class="img-fluid rounded" alt="Compressed Image">
                                                <div class="mt-2">
                                                    <small class="text-muted">Size: <span id="newSize"></span></small><br>
                                                    <small class="text-muted">File size: <span id="newFileSize"></span></small><br>
                                                    <small class="text-muted">Compression: <span id="compressionRatio"></span></small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-primary" id="downloadBtn">
                                                        <i class="fas fa-download"></i> Download
                                                    </button>
                                                    <button class="btn btn-outline-secondary" id="copyBtn">
                                                        <i class="fas fa-copy"></i> Copy to Clipboard
                                                    </button>
                                                    <button class="btn btn-outline-info" id="shareBtn">
                                                        <i class="fas fa-share"></i> Share
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ad Space -->
                    <div class="ad-space mt-4">
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-7389985631571522"
                            data-ad-slot="1701935776"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main JS -->
    <script src="../js/main.js"></script>
    
    <script>
        let originalImage = null;
        let originalFileSize = 0;
        let compressedImage = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeImageCompressor();
        });

        function initializeImageCompressor() {
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValue = document.getElementById('qualityValue');
            const compressBtn = document.getElementById('compressBtn');

            qualitySlider.addEventListener('input', function() {
                qualityValue.textContent = this.value + '%';
            });

            imageInput.addEventListener('change', handleFileSelect);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => imageInput.click());
            compressBtn.addEventListener('click', compressImage);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                processImage(file);
            } else {
                MultiTools.showError('Please select a valid image file.');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    processImage(file);
                } else {
                    MultiTools.showError('Please select a valid image file.');
                }
            }
        }

        function processImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;
                    originalFileSize = file.size;
                    displayPreview(img, file);
                    document.getElementById('compressBtn').disabled = false;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function displayPreview(img, file) {
            const previewImg = document.getElementById('previewImg');
            const imagePreview = document.getElementById('imagePreview');
            const originalSize = document.getElementById('originalSize');
            const originalFileSize = document.getElementById('originalFileSize');

            previewImg.src = img.src;
            imagePreview.style.display = 'block';
            originalSize.textContent = `${img.width} × ${img.height} px`;
            originalFileSize.textContent = MultiTools.formatFileSize(file.size);
        }

        function compressImage() {
            if (!originalImage) {
                MultiTools.showError('Please select an image first.');
                return;
            }

            const quality = document.getElementById('qualitySlider').value / 100;
            const maxWidth = parseInt(document.getElementById('maxWidth').value);
            const maxHeight = parseInt(document.getElementById('maxHeight').value);
            const maintainAspectRatio = document.getElementById('maintainAspectRatio').checked;
            const format = document.getElementById('formatSelect').value;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            let newWidth = originalImage.width;
            let newHeight = originalImage.height;

            if (maintainAspectRatio) {
                const ratio = Math.min(maxWidth / newWidth, maxHeight / newHeight);
                if (ratio < 1) {
                    newWidth *= ratio;
                    newHeight *= ratio;
                }
            } else {
                if (newWidth > maxWidth) newWidth = maxWidth;
                if (newHeight > maxHeight) newHeight = maxHeight;
            }

            canvas.width = newWidth;
            canvas.height = newHeight;

            ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

            let mimeType = 'image/jpeg';
            if (format === 'png') mimeType = 'image/png';
            else if (format === 'webp') mimeType = 'image/webp';

            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                displayResult(url, blob, newWidth, newHeight);
            }, mimeType, quality);
        }

        function displayResult(url, blob, width, height) {
            const resultImg = document.getElementById('resultImg');
            const resultContainer = document.getElementById('resultContainer');
            const newSize = document.getElementById('newSize');
            const newFileSize = document.getElementById('newFileSize');
            const compressionRatio = document.getElementById('compressionRatio');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const shareBtn = document.getElementById('shareBtn');

            resultImg.src = url;
            resultContainer.style.display = 'block';
            newSize.textContent = `${width} × ${height} px`;
            newFileSize.textContent = MultiTools.formatFileSize(blob.size);

            const ratio = ((originalFileSize - blob.size) / originalFileSize * 100).toFixed(1);
            compressionRatio.textContent = `${ratio}% smaller`;

            compressedImage = { url, blob, width, height };

            downloadBtn.onclick = () => {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'compressed-image.' + document.getElementById('formatSelect').value;
                link.click();
            };

            copyBtn.onclick = () => {
                blob.arrayBuffer().then(buffer => {
                    const uint8Array = new Uint8Array(buffer);
                    const mimeType = blob.type;
                    navigator.clipboard.write([
                        new ClipboardItem({
                            [mimeType]: new Blob([uint8Array], { type: mimeType })
                        })
                    ]).then(() => {
                        MultiTools.showSuccess('Image copied to clipboard!');
                    }).catch(() => {
                        MultiTools.showError('Failed to copy image to clipboard.');
                    });
                });
            };

            shareBtn.onclick = () => {
                if (navigator.share) {
                    navigator.share({
                        title: 'Compressed Image',
                        text: 'Check out this compressed image I created using Multi-Tools!',
                        files: [new File([blob], 'compressed-image.' + document.getElementById('formatSelect').value, { type: blob.type })]
                    });
                } else {
                    MultiTools.showInfo('Sharing not supported in this browser.');
                }
            };

            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>