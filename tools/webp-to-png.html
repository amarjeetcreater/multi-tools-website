<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert WebP to PNG - Multi-Tools</title>
    <meta name="description" content="Convert WebP images to PNG format. Free online WebP to PNG converter.">
    <meta name="keywords" content="webp to png, webp converter, image converter">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
    crossorigin="anonymous"></script>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="tool-container">
                    <div class="text-center mb-4">
                        <h1><i class="fas fa-exchange-alt"></i> Convert WebP to PNG</h1>
                        <p class="lead">Convert WebP images to PNG format with transparency support</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-upload"></i> Upload WebP Image</h5>
                                </div>
                                <div class="card-body">
                                    <div class="file-upload-area" id="uploadArea">
                                        <div class="upload-content">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                            <h5>Drag & Drop WebP Image Here</h5>
                                            <p>or click to browse</p>
                                            <input type="file" id="imageInput" accept="image/webp,image/*" class="file-input">
                                            <button class="btn btn-primary" onclick="document.getElementById('imageInput').click()">
                                                <i class="fas fa-folder-open"></i> Choose File
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="imagePreview" class="mt-3" style="display: none;">
                                        <h6>Original WebP Image:</h6>
                                        <img id="previewImg" class="img-fluid rounded" alt="Preview">
                                        <div class="mt-2">
                                            <small class="text-muted">Size: <span id="imageSize"></span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-cogs"></i> Conversion Settings</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="maxWidth" class="form-label">Max Width (px):</label>
                                        <input type="number" class="form-control" id="maxWidth" value="1920" min="100" max="4000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxHeight" class="form-label">Max Height (px):</label>
                                        <input type="number" class="form-control" id="maxHeight" value="1080" min="100" max="4000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="maintainAspectRatio" checked>
                                            <label class="form-check-label" for="maintainAspectRatio">
                                                Maintain aspect ratio
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="preserveTransparency" checked>
                                            <label class="form-check-label" for="preserveTransparency">
                                                Preserve transparency
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="convertBtn" disabled>
                                        <i class="fas fa-exchange-alt"></i> Convert to PNG
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-download"></i> PNG Result</h5>
                                </div>
                                <div class="card-body">
                                    <div id="resultContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Converted PNG Image:</h6>
                                                <img id="resultImg" class="img-fluid rounded" alt="Converted PNG">
                                                <div class="mt-2">
                                                    <small class="text-muted">New size: <span id="newSize"></span></small><br>
                                                    <small class="text-muted">File size: <span id="fileSize"></span></small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-primary" id="downloadBtn">
                                                        <i class="fas fa-download"></i> Download PNG
                                                    </button>
                                                    <button class="btn btn-outline-secondary" id="copyBtn">
                                                        <i class="fas fa-copy"></i> Copy to Clipboard
                                                    </button>
                                                    <button class="btn btn-outline-info" id="shareBtn">
                                                        <i class="fas fa-share"></i> Share
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ad Space -->
                    <div class="ad-space mt-4">
                        <div class="ad-placeholder">
                            <i class="fas fa-ad"></i>
                            <p>Advertisement Space</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main JS -->
    <script src="../js/main.js"></script>
    
    <script>
        let originalImage = null;
        let convertedImage = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeWebpToPng();
        });

        function initializeWebpToPng() {
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            const convertBtn = document.getElementById('convertBtn');

            imageInput.addEventListener('change', handleFileSelect);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => imageInput.click());
            convertBtn.addEventListener('click', convertToPng);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                processImage(file);
            } else {
                MultiTools.showError('Please select a valid image file.');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    processImage(file);
                } else {
                    MultiTools.showError('Please select a valid image file.');
                }
            }
        }

        function processImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;
                    displayPreview(img, file);
                    document.getElementById('convertBtn').disabled = false;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function displayPreview(img, file) {
            const previewImg = document.getElementById('previewImg');
            const imagePreview = document.getElementById('imagePreview');
            const imageSize = document.getElementById('imageSize');

            previewImg.src = img.src;
            imagePreview.style.display = 'block';
            imageSize.textContent = `${img.width} × ${img.height} px (${MultiTools.formatFileSize(file.size)})`;
        }

        function convertToPng() {
            if (!originalImage) {
                MultiTools.showError('Please select an image first.');
                return;
            }

            const maxWidth = parseInt(document.getElementById('maxWidth').value);
            const maxHeight = parseInt(document.getElementById('maxHeight').value);
            const maintainAspectRatio = document.getElementById('maintainAspectRatio').checked;
            const preserveTransparency = document.getElementById('preserveTransparency').checked;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            let newWidth = originalImage.width;
            let newHeight = originalImage.height;

            if (maintainAspectRatio) {
                const ratio = Math.min(maxWidth / newWidth, maxHeight / newHeight);
                if (ratio < 1) {
                    newWidth *= ratio;
                    newHeight *= ratio;
                }
            } else {
                if (newWidth > maxWidth) newWidth = maxWidth;
                if (newHeight > maxHeight) newHeight = maxHeight;
            }

            canvas.width = newWidth;
            canvas.height = newHeight;

            if (preserveTransparency) {
                ctx.clearRect(0, 0, newWidth, newHeight);
            }

            ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                displayResult(url, blob, newWidth, newHeight);
            }, 'image/png');
        }

        function displayResult(url, blob, width, height) {
            const resultImg = document.getElementById('resultImg');
            const resultContainer = document.getElementById('resultContainer');
            const newSize = document.getElementById('newSize');
            const fileSize = document.getElementById('fileSize');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const shareBtn = document.getElementById('shareBtn');

            resultImg.src = url;
            resultContainer.style.display = 'block';
            newSize.textContent = `${width} × ${height} px`;
            fileSize.textContent = MultiTools.formatFileSize(blob.size);

            convertedImage = { url, blob, width, height };

            downloadBtn.onclick = () => {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'converted-image.png';
                link.click();
            };

            copyBtn.onclick = () => {
                blob.arrayBuffer().then(buffer => {
                    const uint8Array = new Uint8Array(buffer);
                    navigator.clipboard.write([
                        new ClipboardItem({
                            'image/png': new Blob([uint8Array], { type: 'image/png' })
                        })
                    ]).then(() => {
                        MultiTools.showSuccess('Image copied to clipboard!');
                    }).catch(() => {
                        MultiTools.showError('Failed to copy image to clipboard.');
                    });
                });
            };

            shareBtn.onclick = () => {
                if (navigator.share) {
                    navigator.share({
                        title: 'Converted PNG Image',
                        text: 'Check out this PNG image I converted using Multi-Tools!',
                        files: [new File([blob], 'converted-image.png', { type: 'image/png' })]
                    });
                } else {
                    MultiTools.showInfo('Sharing not supported in this browser.');
                }
            };

            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

    <script>
    (function() {
      function getTheme() {
        try {
          var t = localStorage.getItem('theme');
          if (t === 'dark' || t === 'light') return t;
        } catch(e) {}
        return 'light';
      }
      document.documentElement.setAttribute('data-theme', getTheme());
    })();
    </script>
</body>
</html>