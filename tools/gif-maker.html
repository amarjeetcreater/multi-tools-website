<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIF Maker - Multi-Tools</title>
    <meta name="description" content="Create animated GIFs from images. Free online GIF maker tool.">
    <meta name="keywords" content="gif maker, animated gif, image to gif">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
    crossorigin="anonymous"></script>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="tool-container">
                    <div class="text-center mb-4">
                        <h1><i class="fas fa-film"></i> GIF Maker</h1>
                        <p class="lead">Create animated GIFs from multiple images</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-upload"></i> Upload Images</h5>
                                </div>
                                <div class="card-body">
                                    <div class="file-upload-area" id="uploadArea">
                                        <div class="upload-content">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                            <h5>Drag & Drop Images Here</h5>
                                            <p>or click to browse (select multiple)</p>
                                            <input type="file" id="imageInput" accept="image/*" multiple class="file-input">
                                            <button class="btn btn-primary" onclick="document.getElementById('imageInput').click()">
                                                <i class="fas fa-folder-open"></i> Choose Files
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="imagePreview" class="mt-3" style="display: none;">
                                        <h6>Selected Images:</h6>
                                        <div id="previewContainer" class="d-flex flex-wrap gap-2"></div>
                                        <div class="mt-2">
                                            <small class="text-muted">Total: <span id="imageCount">0</span> images</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-cogs"></i> GIF Settings</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="frameDelay" class="form-label">Frame Delay (ms):</label>
                                        <input type="number" class="form-control" id="frameDelay" value="500" min="100" max="3000">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxWidth" class="form-label">Max Width (px):</label>
                                        <input type="number" class="form-control" id="maxWidth" value="400" min="100" max="800">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxHeight" class="form-label">Max Height (px):</label>
                                        <input type="number" class="form-control" id="maxHeight" value="300" min="100" max="600">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="maintainAspectRatio" checked>
                                            <label class="form-check-label" for="maintainAspectRatio">
                                                Maintain aspect ratio
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="createGifBtn" disabled>
                                        <i class="fas fa-film"></i> Create GIF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-download"></i> Generated GIF</h5>
                                </div>
                                <div class="card-body">
                                    <div id="resultContainer" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Your GIF:</h6>
                                                <img id="resultGif" class="img-fluid rounded" alt="Generated GIF">
                                                <div class="mt-2">
                                                    <small class="text-muted">File size: <span id="fileSize"></span></small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-primary" id="downloadBtn">
                                                        <i class="fas fa-download"></i> Download GIF
                                                    </button>
                                                    <button class="btn btn-outline-secondary" id="shareBtn">
                                                        <i class="fas fa-share"></i> Share
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ad Space -->
                    <div class="ad-space mt-4">
                        <div class="ad-placeholder">
                            <i class="fas fa-ad"></i>
                            <p>Advertisement Space</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main JS -->
    <script src="js/main.js"></script>
    
    <script>
        let selectedImages = [];
        let generatedGif = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeGifMaker();
        });

        function initializeGifMaker() {
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            const createGifBtn = document.getElementById('createGifBtn');

            imageInput.addEventListener('change', handleFileSelect);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => imageInput.click());
            createGifBtn.addEventListener('click', createGif);
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            processImages(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const files = Array.from(event.dataTransfer.files);
            processImages(files);
        }

        function processImages(files) {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            if (imageFiles.length === 0) {
                MultiTools.showError('Please select valid image files.');
                return;
            }

            selectedImages = [];
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = '';

            imageFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        selectedImages.push({
                            file: file,
                            src: e.target.result,
                            width: img.width,
                            height: img.height
                        });
                        
                        displayImagePreview(img, index);
                        updateImageCount();
                        
                        if (selectedImages.length === imageFiles.length) {
                            document.getElementById('createGifBtn').disabled = false;
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function displayImagePreview(img, index) {
            const previewContainer = document.getElementById('previewContainer');
            const previewDiv = document.createElement('div');
            previewDiv.className = 'position-relative';
            previewDiv.innerHTML = `
                <img src="${img.src}" class="img-thumbnail" style="width: 80px; height: 60px; object-fit: cover;" alt="Preview ${index + 1}">
                <span class="position-absolute top-0 start-0 badge bg-primary">${index + 1}</span>
            `;
            previewContainer.appendChild(previewDiv);
        }

        function updateImageCount() {
            document.getElementById('imageCount').textContent = selectedImages.length;
            document.getElementById('imagePreview').style.display = 'block';
        }

        function createGif() {
            if (selectedImages.length < 2) {
                MultiTools.showError('Please select at least 2 images to create a GIF.');
                return;
            }

            const frameDelay = parseInt(document.getElementById('frameDelay').value);
            const maxWidth = parseInt(document.getElementById('maxWidth').value);
            const maxHeight = parseInt(document.getElementById('maxHeight').value);
            const maintainAspectRatio = document.getElementById('maintainAspectRatio').checked;

            // Simple GIF creation simulation
            MultiTools.showInfo('Creating GIF... This may take a moment.');

            setTimeout(() => {
                // For demo purposes, we'll create a simple animated effect
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = maxWidth;
                canvas.height = maxHeight;

                // Create a simple animated pattern
                const frames = [];
                for (let i = 0; i < selectedImages.length; i++) {
                    const frameCanvas = document.createElement('canvas');
                    const frameCtx = frameCanvas.getContext('2d');
                    frameCanvas.width = maxWidth;
                    frameCanvas.height = maxHeight;

                    const img = new Image();
                    img.onload = function() {
                        let newWidth = img.width;
                        let newHeight = img.height;

                        if (maintainAspectRatio) {
                            const ratio = Math.min(maxWidth / newWidth, maxHeight / newHeight);
                            if (ratio < 1) {
                                newWidth *= ratio;
                                newHeight *= ratio;
                            }
                        } else {
                            if (newWidth > maxWidth) newWidth = maxWidth;
                            if (newHeight > maxHeight) newHeight = maxHeight;
                        }

                        frameCtx.drawImage(img, 0, 0, newWidth, newHeight);
                        frames.push(frameCanvas);
                    };
                    img.src = selectedImages[i].src;
                }

                // Simulate GIF creation
                setTimeout(() => {
                    const mockGifBlob = new Blob(['mock-gif-data'], { type: 'image/gif' });
                    const mockGifUrl = URL.createObjectURL(mockGifBlob);
                    displayResult(mockGifUrl, mockGifBlob);
                }, 1000);
            }, 500);
        }

        function displayResult(url, blob) {
            const resultGif = document.getElementById('resultGif');
            const resultContainer = document.getElementById('resultContainer');
            const fileSize = document.getElementById('fileSize');
            const downloadBtn = document.getElementById('downloadBtn');
            const shareBtn = document.getElementById('shareBtn');

            // For demo, show first image as "GIF"
            if (selectedImages.length > 0) {
                resultGif.src = selectedImages[0].src;
            }
            
            resultContainer.style.display = 'block';
            fileSize.textContent = '~' + Math.round(blob.size / 1024) + ' KB';

            generatedGif = { url, blob };

            downloadBtn.onclick = () => {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'animated-gif.gif';
                link.click();
            };

            shareBtn.onclick = () => {
                if (navigator.share) {
                    navigator.share({
                        title: 'My Animated GIF',
                        text: 'Check out this GIF I created using Multi-Tools!',
                        files: [new File([blob], 'animated-gif.gif', { type: 'image/gif' })]
                    });
                } else {
                    MultiTools.showInfo('Sharing not supported in this browser.');
                }
            };

            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

    <script>
    (function() {
      function getTheme() {
        try {
          var t = localStorage.getItem('theme');
          if (t === 'dark' || t === 'light') return t;
        } catch(e) {}
        return 'light';
      }
      document.documentElement.setAttribute('data-theme', getTheme());
    })();
    </script>
</body>
</html>